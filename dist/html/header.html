<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <h1 class="fl">
        <a a href=" ### "></a>
    </h1>
    <div class="site fl">
        <a a href=" ### ">
            <img src="img/1569409328.gif" alt="">
        </a>
    </div>
    <div class="head-search">
        <div class="search-option">
            <ul class="tab">
                <li>
                    <a a href=" ### ">商品</a>
                    <i class="arrow"></i>
                </li>
                <li>
                    <a a href=" ### ">店铺</a>
                </li>
            </ul>
        </div>
        <form class="search-form" action="###" method="GET">
            <input type="text" placeholder="请输入您要搜索的商品关键字" name="keyword" id="keyword">
            <input type="button" value="搜索" class="search-btn">
        </form>
        <div class="key clearfix">
            <span class="fl">热门搜索：</span>
            <ul class="clearfix fl">
                <li><a a href=" ### ">潮男</a></li>
                <li><a a href=" ### ">外套</a></li>
                <li><a a href=" ### ">七分裤</a></li>
                <li><a a href=" ### ">T恤</a></li>
                <li><a a href=" ### ">衬衫</a></li>
                <li><a a href=" ### ">香水</a></li>
                <li><a a href=" ### ">帆布鞋</a></li>
                <li><a a href=" ### ">运动休闲</a></li>
            </ul>
        </div>
    </div>
    <div class="head-user-menu">
        <dl class="my-mall  clearfix">
            <dt>
                        <span class="ico"></span>
                        <span>会员中心</span>
                        <i class="arrow"></i>
                    </dt>
            <dd>
                <div class="sub-title">
                    <h4>
                        <!-- 殇乁黑羽斩华
                        <div class="nc-grade-mini" style="cursor:pointer;">V0</div> -->

                    </h4>
                    <a a href=" ### ">进入会员中心<i></i></a>
                </div>
                <div class="user-centent-menu">
                    <ul>
                        <li><a a href=" ### ">站内消息(<span>0</span>)</a></li>
                        <li class="fr"><a a href=" ### " class="fl">我的订单<i></i></a></li>
                        <li><a a href=" ### ">咨询回复(<span id="member_consult">0</span>)</a></li>
                        <li class="fr"><a a href=" ### " class="fl">我的收藏<i></i></a></li>
                        <li><a a href=" ### ">代金券(<span id="member_voucher">0</span>)</a></li>
                        <li class="fr"><a a href=" ### " class="fl">我的积分<i></i></a></li>
                    </ul>
                </div>
                <div class="browse-history">
                    <div class="part-title clearfix">
                        <h4 class="fl">最近浏览商品</h4>
                        <span class="fr"><a a href=" ### ">全部浏览历史</a></span>
                    </div>
                    <ul>
                        <!-- <li class="no-goods">暂无商品</li> -->
                        <li class="goods-thumb">
                            <a href="###" title="回力夏季休闲低帮鞋拼接PU皮板鞋潮流学生鞋防水pu皮面布鞋 蓝色 39" target="_blank">
                                <img src="https://www.nanshig.com/data/upload/shop/store/goods/28/28_05321984918797058_60.jpg" alt="回力夏季休闲低帮鞋拼接PU皮板鞋潮流学生鞋防水pu皮面布鞋 蓝色 39">
                            </a>
                        </li>
                    </ul>
                </div>
            </dd>
        </dl>
        <dl class="my-cart  clearfix">
            <div class="addcart-goods-num">1</div>
            <dt>
                <span class="ico"></span>
                <span>我的购物车</span>
                <i class="arrow"></i>
            </dt>
            <dd>
                <div class="sub-title">
                    <h4>最新加入的商品</h4>
                </div>
                <div class="incart-goods-box">
                    <div class="incart-goods-box">
                        <div class="incart-goods">
                            <!-- <dl id="cart_item_227010">
                                <dt class="goods-name"><a href="https://www.nanshig.com/shop/item-227010.html">冬季胖子棉衣男士灯芯绒加厚棉服韩版个性外套加肥大码潮男装棉袄 黄色 S</a></dt>
                                <dd class="goods-thumb">
                                    <a href="https://www.nanshig.com/shop/item-227010.html" title="冬季胖子棉衣男士灯芯绒加厚棉服韩版个性外套加肥大码潮男装棉袄 黄色 S"><img src="https://www.nanshig.com/data/upload/shop/store/goods/39/39_05982346005548882_60.jpg"></a>
                                </dd>
                                <dd class="goods-sales"></dd>
                                <dd class="goods-price">¥<em>169.00</em>×<span>1</span></dd>
                                <dd class="handle"><em><a href=" ### ;" >删除</a></em></dd>
                            </dl> -->
                            <!-- <div class="no-order">
                                <span>您的购物车中暂无商品，赶快选择心爱的商品吧！</span>
                            </div> -->
                        </div>
                        <div class="ps-scrollbar-y-rail">
                            <div class="ps-scrollbar-y" style="top: 55px; height: 212px;"></div>
                        </div>
                    </div>

                </div>
                <div class="checkout">
                    <span class="total-price">共<i>5</i>种商品&nbsp;&nbsp;总计金额：¥<em>514.00</em></span>
                    <a href="" class="btn-cart">结算购物车中的商品</a>
                </div>
            </dd>
        </dl>
    </div>
</body>
<script src="js/setcookie.js"></script>
<script>
    (() => {
        class headClass {
            constructor() {
                this.init();

            }
            init() {
                if (getcookie('uname')) {
                    $.ajax({
                        url: 'api/01index.php',
                        type: 'post',
                        data: {
                            fangfa: 'setlogin',
                            name: getcookie('uname')
                        },
                        success: str => {

                            $('.head-user-menu .sub-title h4').html(` ${str}
                        <div class="nc-grade-mini" style="cursor:pointer;">V0</div>`);
                        }
                    });
                    $('.checkout a').attr('href', '06cart.html');
                } else {
                    $('.checkout a').attr('href', '05login.html');
                }

                $.ajax({
                    url: 'api/01index.php',
                    type: 'post',
                    data: {
                        fangfa: 'sortTab',
                        tabna: 'cart',
                        tabHeser: 'gid'
                    },
                    success: str => {

                        this.showtime(str);
                    }
                });
                this.total();
                $('.incart-goods').on('click', e => {

                    if (e.target.innerHTML == '删除') {
                        // console.log(e.target.parentNode.parentNode.parentNode);
                        e.target.parentNode.parentNode.parentNode.parentNode.removeChild(e.target.parentNode.parentNode.parentNode);
                        $.ajax({
                            url: 'api/01index.php',
                            type: 'post',
                            data: {
                                fangfa: 'setCart',
                                id: e.target.parentNode.parentNode.parentNode.dataset.id
                            }
                        });
                        this.total();
                    }
                });
            }
            showtime(str) {
                let obj = JSON.parse(str);
                let g = obj.data.list;
                // console.log(g);
                let arr = [];
                let arr2 = [];
                for (let i = 0; i < g.length; i++) {
                    arr.push(g[i].gid);
                    arr2.push(g[i].num);
                }

                $.ajax({
                    url: 'api/01index.php',
                    type: 'post',
                    data: {
                        fangfa: 'sortTab',
                        tabna: 'shangyi',
                    },
                    success: str => {

                        this.showtimeDa(str, arr, arr2);
                    }
                });

            }
            showtimeDa(str, arr, arr2) {
                let obj = JSON.parse(str);
                let g = obj.data.list;
                let htmlstr = '';
                for (let i = 0; i < g.length; i++) {
                    for (let j = 0; j < arr.length; j++) {
                        if (arr[j] == g[i].id) {
                            let arr = g[i].imgurl.split('&');
                            htmlstr += `<dl id="cart_item_${g[i].id}" data-id="${g[i].id}">
                                            <dt class="goods-name"><a href="https://www.nanshig.com/shop/item-227010.html">${g[i].name}</a></dt>
                                            <dd class="goods-thumb">
                                                <a href="https://www.nanshig.com/shop/item-227010.html" title="${g[i].name}"><img src="${arr[0]}"></a>
                                            </dd>
                                            <dd class="goods-sales"></dd>
                                            <dd class="goods-price">¥<em>${g[i].salePrice}</em>×<span>${arr2[j]}</span></dd>
                                            <dd class="handle"><em><a href=" ### ;" >删除</a></em></dd>
                                        </dl>`
                            break;
                        } else {
                            continue;
                        }
                    }
                }
                $('.incart-goods').html(htmlstr);
                this.total();
            }
            total() {
                let total = 0;
                let len = $('.my-cart .incart-goods dl').length;
                for (let i = 1; i <= len; i++) {
                    let price = $('.my-cart .incart-goods dl:nth-child(' + [i] + ') .goods-price em').html();
                    let num = $('.my-cart .incart-goods dl:nth-child(' + [i] + ') .goods-price span').html();
                    total += price * num;
                }
                $('.my-cart .checkout span i').html(len);
                $('.my-cart .checkout span em').html(total);
                if (len == 0) {
                    $('.addcart-goods-num').css('display', 'none');
                } else {
                    $('.addcart-goods-num').css('display', 'block');
                    $('.addcart-goods-num').html(len);
                }

            }
        }
        new headClass();
    })();
</script>

</html>