<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <div class="center" id="conbtn">
        <div class="user ">
            <div class="userimg ">
                <i></i>
            </div>
            <span></span>
        </div>
        <ul>
            <li class="cartbox">
                <a class="cart  " a href=" ###"></a>
                <span>购物车</span>
                <i id="rtoobar_cart_count" class="new_msg">3</i>
            </li>
            <li class="toolsbox">
                <a class="tools  " a href=" ###"></a>
                <span>对比</span>
            </li>
            <li class="backtopbox">
                <a class="backtop atv" a href=" ###"></a>
                <span>顶部</span>
            </li>
        </ul>
    </div>
    <div class="content-box" id="content-compare">
        <div class="top">
            <h3>商品对比</h3>
            <a href=" ### ;" class="close" title="隐藏"></a>
        </div>
        <div id="comparelist">
            <ul class="goods-list">
                <li>
                    <dl class="goods-info">
                        <dt class="goods-pic"> <a href=" ### ;" title="夏季男士修身西服条纹马夹职业装西装马甲套装韩版短裤潮男两件套 深蓝色套装 S"> <img src="https://www.nanshig.com/data/upload/shop/store/goods/32/32_05543334548706345_240.jpg" alt="夏季男士修身西服条纹马夹职业装西装马甲套装韩版短裤潮男两件套 深蓝色套装 S" title="夏季男士修身西服条纹马夹职业装西装马甲套装韩版短裤潮男两件套 深蓝色套装 S"> </a> </dt>
                        <dd class="goods-name"><a href=" ### ;">夏季男士修身西服条纹马夹职业装西装马甲套装韩版短裤潮男两件套 深蓝色套装 S</a> </dd>
                        <dd class="goods-price">¥176.00<span class="del">删除</span></dd>
                    </dl>
                </li>
                <li>
                    <dl class="goods-info">
                        <dt class="goods-pic"> <a href=" ### ;" title="秋季2017新款休闲运动套装男韩版潮流学生社会小伙男士卫衣两件套 黑色 M"> <img src="https://www.nanshig.com/data/upload/shop/store/goods/25/25_05563170129571341_240.jpg" alt="秋季2017新款休闲运动套装男韩版潮流学生社会小伙男士卫衣两件套 黑色 M" title="秋季2017新款休闲运动套装男韩版潮流学生社会小伙男士卫衣两件套 黑色 M"> </a> </dt>
                        <dd class="goods-name"><a href=" ### ;">秋季2017新款休闲运动套装男韩版潮流学生社会小伙男士卫衣两件套 黑色 M</a> </dd>
                        <dd class="goods-price">¥119.00<span class="del">删除</span></dd>
                    </dl>
                </li>
                <li>
                    <div class="no-compare">暂无对比项</div>
                </li>
                <li>
                    <div class="no-compare">暂无对比项</div>
                </li>
            </ul>
            <div class="btn-box">
                <span>对比</span>
                <span>清空</span> </div>
        </div>
    </div>
    <div class="content-box" id="content-cart">
        <div class="top">
            <h3>我的购物车</h3>
            <a href=" ### ;" class="close" title="隐藏"></a>
        </div>
        <div id="rtoolbar_cartlist">
            <ul class="cart-list">

                <!-- <li class="clearfix" nctpye="cart_item_35264">
                    <div class="goods-pic">
                        <a href=" ### ;" title="冬季情侣连帽面包服男士帅气短款棉衣韩版宽松加厚棉袄潮男装外套 黑色 S" target="_blank" ;=""><img src="https://www.nanshig.com/data/upload/shop/store/goods/39/39_05982354899298264_60.jpg" alt="冬季情侣连帽面包服男士帅气短款棉衣韩版宽松加厚棉袄潮男装外套 黑色 S"></a>
                    </div>
                    <dl>
                        
                        <dt class="goods-name"><a href=" ### ;" title="冬季情侣连帽面包服男士帅气短款棉衣韩版宽松加厚棉袄潮男装外套 黑色 S" target="_blank" ;="">冬季情侣连帽面包服男士帅气短款棉衣韩版宽松加厚棉袄潮男装外套 黑色 S</a></dt>
                        <dd><em>¥</em><em class="goods-price">169.01</em>×<span>1</span></dd>
                    </dl>
                    <a href=" ###" class="del" title="删除">X</a>
                </li> -->
                <!-- <dd>暂无商品</dd> -->
                <div class="nolist">
                    <dl>
                        <dd>暂无商品</dd>
                    </dl>
                </div>
            </ul>
            <div class="btn-box">
                <div nctype="rtoolbar_total_price" class="total-price">共计金额：<em>¥</em><em class="goods-price">169.00</em></div>
                <a href=" ### ;">结算购物车中的商品</a>
            </div>
        </div>
    </div>
    <div class="exit ">
        <a href=" ### " class="hidbtn"></a>
    </div>
    <div class="nc-hidebar-bg">
        <div class="frame"></div>
        <div class="user-avatar">
            <img src="https://www.nanshig.com/data/upload/shop/avatar/avatar_27037.jpg">
        </div>

        <div class="show"></div>
    </div>
</body>
<script>
    (() => {

        class fixed_box {
            constructor() {
                this.show();
                this.init();
                this.istrue = true;
                this.total();
            }
            show() {
                $.ajax({
                    url: 'api/01index.php',
                    type: 'post',
                    data: {
                        fangfa: 'sortTab',
                        tabna: 'cart',
                        tabHeser: 'gid'
                    },
                    success: str => {

                        this.showtime(str);
                    }
                });
            }
            total() {
                let total = 0;
                let len = $('#content-cart .cart-list li.clearfix').length
                $('.cartbox #rtoobar_cart_count').html(len).one(() => {
                    if (len == 0) {
                        $('.cartbox #rtoobar_cart_count').css('display', 'none');
                        $('#content-cart .cart-list .nolist').css('display', 'block');
                        $('.btn-box .total-price').css('display', 'none');
                    } else {
                        $('#content-cart .cart-list .nolist').css('display', 'none');

                    }
                });
                $('#content-cart .cart-list').ready(() => {
                    for (let i = 1; i <= len; i++) {
                        let price = $('#content-cart .cart-list li:nth-child(' + [i] + ') .goods-price').html();
                        let numb = $('#content-cart .cart-list li:nth-child(' + [i] + ') dl dd span').html();
                        total += price * numb;
                    };
                });
                $('.btn-box .total-price .goods-price').html(total.toFixed(2));
            }
            showtime(str) {
                let obj = JSON.parse(str);
                let g = obj.data.list;
                let arr = [];
                let arr2 = [];
                for (let i = 0; i < g.length; i++) {
                    arr.push(g[i].gid);
                    arr2.push(g[i].num);
                }

                $.ajax({
                    url: 'api/01index.php',
                    type: 'post',
                    data: {
                        fangfa: 'sortTab',
                        tabna: 'shangyi',
                    },
                    success: str => {
                        this.showtimeDa(str, arr, arr2);
                    }
                });

            }
            showtimeDa(str, arr, arr2) {
                let obj = JSON.parse(str);
                let g = obj.data.list;
                let htmlstr = '';
                for (let i = 0; i < g.length; i++) {
                    for (let j = 0; j < arr.length; j++) {
                        if (arr[j] == g[i].id) {
                            let arr = g[i].imgurl.split('&');
                            htmlstr += `<li class="clearfix" nctpye="cart_item_${g[i].id}" data-id="${g[i].id}">
                                            <div class="goods-pic">
                                                <a href=" ### ;" title="${g[i].name}" target="_blank" ;=""><img src="${arr[0]}" alt="${g[i].name}"></a>
                                            </div>
                                            <dl>
                                                
                                                <dt class="goods-name"><a href=" ### ;" title="${g[i].name}" target="_blank" ;="">${g[i].name}</a></dt>
                                                <dd><em>¥</em><em class="goods-price">${g[i].salePrice}</em>×<span>${arr2[j]}</span></dd>
                                            </dl>
                                            <a href=" ###" class="del" title="删除">X</a>
                                        </li>`;
                            break;
                        } else {
                            continue;
                        }
                    }
                }
                $('.cart-list').html(htmlstr);
                // this.init();
                this.total();
            }
            init() {
                if (getcookie('uname')) {
                    $.ajax({
                        url: 'api/01index.php',
                        type: 'post',
                        data: {
                            fangfa: 'setlogin',
                            name: getcookie('uname')
                        },
                        success: str => {
                            $('.user span').html('个人中心');
                        }
                    });
                    $(' .btn-box a').click(() => {
                        window.location.href = '06cart.html';
                    })
                } else {
                    $('.user span').html('未登录');
                    $('.cartbox').click(() => {
                        window.location.href = '05login.html';
                    })

                }
                let str = location.href;
                let _this = this;
                if (str.indexOf('list') != -1 || str.indexOf('item') != -1) {
                    $('#fixedbox .toolsbox').css('display', 'block');
                } else {
                    $('#fixedbox .toolsbox').css('display', 'none');
                }
                $('.center').on('click', e => {
                    if (e.target.parentNode.className == 'backtopbox') {
                        _this.backtop();
                    }
                    if (e.target.parentNode.className == 'cartbox') {
                        if (_this.istrue) {
                            _this.istrue = false;
                            _this.cartBox('#rtoolbar_cartlist', '#comparelist');

                        } else {
                            _this.istrue = true;
                            _this.cartBoxRm('#rtoolbar_cartlist', '#comparelist');
                        }
                    }
                    if (e.target.parentNode.className == 'toolsbox') {
                        if (_this.istrue) {
                            _this.istrue = false;
                            _this.cartBox('#comparelist', '#rtoolbar_cartlist');
                        } else {
                            _this.istrue = true;
                            _this.cartBoxRm('#comparelist', '#rtoolbar_cartlist');
                        }
                    }
                });
                $('.content-box').on('click', e => {
                    if (e.target.className == 'close') {
                        var str = '#' + e.target.parentNode.parentNode.id;
                        var str1, str2;
                        if (str == '#content-cart') {
                            str2 = '#comparelist';
                            str1 = '#rtoolbar_cartlist';
                        }
                        if (str == '#content-compare') {
                            str2 = '#rtoolbar_cartlist';
                            str1 = '#comparelist';
                        }
                        this.cartBoxRm(str1, str2);
                        this.istrue = true;
                    }

                    if (e.target.className == 'del') {

                        let epare = e.target.parentNode.parentNode;
                        if (e.target.parentNode.tagName == 'DD') {
                            // console.log(epare.parentNode.innerHTML);

                            epare.parentNode.parentNode.removeChild(epare.parentNode);
                            $('.goods-list').append(`<li>
                                                        <div class="no-compare">暂无对比项</div>
                                                    </li>`);
                        } else {
                            $.ajax({
                                url: 'api/01index.php',
                                type: 'post',
                                data: {
                                    fangfa: 'setCart',
                                    id: e.target.parentNode.dataset.id
                                },

                            });
                            epare.removeChild(e.target.parentNode);
                        }

                        this.total();
                    }

                });
                $('.exit').on('click', () => {
                    $('#content-compare').css('right', '-250px');
                    $('#content-cart').css('right', '-250px');
                    $('#conbtn').css('right', '-40px');
                    $('.exit .hidbtn').css('right', '-36px');
                    $('.nc-hidebar-bg').css('right', '5px').on('click', () => {
                        $('#conbtn').css('right', '0px');
                        $('.exit .hidbtn').css('right', '0px');
                        $('.nc-hidebar-bg').css('right', '-70px')
                    });
                });
            }
            backtop() {
                clearInterval(timer);
                var timer = setInterval(function() {
                    let topSpeed = window.scrollY / 8;
                    let winTop = window.scrollY - topSpeed;
                    window.scrollTo(0, winTop);
                    if (winTop <= 0) {
                        clearInterval(timer);
                    }
                }, 30);
                window.onwheel = function() {
                    clearInterval(timer);
                }
            }
            cartBox(str1, str2) {
                $(str1).parent().css('right', '0');
                $(str2).parent().css('right', '-250px');

            }
            cartBoxRm(str1, str2) {
                if ($(str2).parent().css('right') == '0px') {
                    $(str2).parent().css('right', '-250px');
                    $(str1).parent().css('right', '0px');
                } else {
                    $(str1).parent().css('right', '-250px');
                }
            }
        }
        new fixed_box();
    })();
</script>

</html>