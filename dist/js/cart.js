class crat_box{constructor(){this.htmls="",this.show(),this.init()}show(){$.ajax({url:"api/01index.php",type:"post",data:{fangfa:"sortTab",tabna:"cart",tabHeser:"gid"},success:t=>{this.showtime(t)}})}showtime(t){let e=JSON.parse(t).data.list,a=[],s=[];for(let t=0;t<e.length;t++)a.push(e[t].gid),s.push(e[t].num);$.ajax({url:"api/01index.php",type:"post",data:{fangfa:"sortTab",tabna:"shangyi"},success:t=>{this.showtimeDa(t,a,s)}})}showtimeDa(t,e,a){let s=JSON.parse(t).data.list,n="";for(let t=0;t<s.length;t++)for(let l=0;l<e.length;l++)if(e[l]==s[t].id){let e=s[t].imgurl.split("&");n+=`<tr id="cart_item_35308" data-id="${s[t].id}" class="shop-list ">\n                    <td><input type="checkbox" checked="" class="istrue" nc_type="eachGoodsCheckBox" value="${s[t].id}|1"  name="cart_id[]"></td>\n                    <td class="w60">\n                        <a href="###" target="_blank" class="ncc-goods-thumb"><img src="${e[0]}" alt="${s[t].name}"></a>\n                    </td>\n                    <td class="tl">\n                        <dl class="ncc-goods-info">\n                            <dt><a href="###" target="_blank">${s[t].name}</a></dt>\n                        </dl>\n                    </td>\n                    <td class="w120"><em id="item35308_price" class="price">${s[t].salePrice}</em></td>\n                    <td class="w120 ws0"><a href="###;" title="减少商品件数" class="add-substract-key tip">-</a>\n                        <input id="input_item_35308" value="${a[l]}" orig="1" changed="1" type="text" class="text w20">\n                        <a href="###;" title="增加商品件数" class="add-substract-key tip">+</a></td>\n                    <td class="w120"> <em id="item35308_subtotal" class="subtotal" nc_type="eachGoodsTotal">68.00</em>\n                    </td>\n                    <td class="w80"> <a href="###">收藏</a><br>\n                        <a href="###">删除</a></td>\n                </tr>`;break}this.htmls=`<thead>\n        <tr>\n            <th class="w50"><label>\n        <input type="checkbox" checked="" value="1" id="selectAll">\n        全选</label></th>\n            <th></th>\n            <th>商品</th>\n            <th class="w120">单价(元)</th>\n            <th class="w120">数量</th>\n            <th class="w120">小计(元)</th>\n            <th class="w80">操作</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <th colspan="20"><strong>店小二：<a href="https://www.nanshig.com/shop/shop-45.html">客观还想要什么</a></strong> <span member_id="14846"></span>\n            </th>\n        </tr>\n        ${n}\n        <tr>\n            <td class="tr" colspan="20">\n                <div class="ncc-store-account">\n                    <dl>\n                        <dt>店铺合计：</dt>\n                        <dd><em nc_type="eachStoreTotal" class="account">225.00</em>元</dd>\n                    </dl>\n                </div>\n            </td>\n        </tr>\n    </tbody>\n    <tfoot>\n        <tr>\n            <td colspan="20">\n                <div class="ncc-all-account">商品总价（不含运费）<em id="cartTotal">592.00</em>元</div>\n            </td>\n        </tr>\n    </tfoot>`,this.init()}init(){$("#form_buy table").ready(()=>{$("#form_buy table").html(this.htmls).ready(()=>{this.total()}),$("#form_buy table tbody").on("click",t=>{if("-"==t.target.innerHTML){let e=t.target.parentNode.children[1].value-1;e<=0&&(e=0),t.target.parentNode.children[1].value=e}if("+"==t.target.innerHTML){let e=1*t.target.parentNode.children[1].value+1;e>=666&&(e=666),t.target.parentNode.children[1].value=e}"删除"==t.target.innerHTML&&($.ajax({url:"api/01index.php",type:"post",data:{fangfa:"setCart",id:t.target.parentNode.parentNode.dataset.id},success:t=>{}}),t.target.parentNode.parentNode.parentNode.removeChild(t.target.parentNode.parentNode)),this.total()}),$("#form_buy table tbody .text").on("keyup",t=>{t.keyCode>95&&t.keyCode<106?t.target.value>=666&&(t.target.value=666):(alert("请输入数字"),t.target.value=1)})}),$("#selectAll").click(()=>{$("#selectAll").prop("checked")?$('.shop-list input[type="checkbox"]').prop("checked",!0):$('.shop-list input[type="checkbox"]').prop("checked",!1),this.total()})}total(){let t=0,e=$(".shop-list").length;for(let a=1;a<=e;a++)if($(".shop-list:nth-child("+[a+1]+") .istrue").prop("checked")){let e=$(".shop-list:nth-child("+[a+1]+") .price").html()*$(".shop-list:nth-child("+[a+1]+") .text").val();t+=1*e.toFixed(2),$(".shop-list:nth-child("+[a+1]+") .subtotal").html(e.toFixed(2))}$(".account").html(t),$("#cartTotal").html(t)}}